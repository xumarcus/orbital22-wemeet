= WeMeet 0.3.0 Developer Guide
Marcus Xu;
:toc:

== TLDR
WeMeet allows user to CRUD a meeting, invite other users to rank preferences to said meeting, and generate allocations to time slots that satisfy these preferences as much as possible.

== Setup
Refer to `README.md` for latest instructions.

.Prerequisites
* https://www.postgresql.org/download/[PostgresSQL 14] (Comes with `pgAdmin4`)
* NodeJS 16.15.0 (Comes with `npm`)
* Recommended IDE: Intellij IDEA Ultimate

=== Installation
* `Main` Configuration:
** Application
** Path: `com.orbital22.wemeet.Main`
* View &rarr; Maven &rarr; Lifecycle &rarr; Install
* Run the app
* Open `localhost:5000`
** Hot loading is not enabled by default

=== Coding style
* Frontend (Javascript): Standard JS
** By default, `npm run start` formats code
* Backend (Java): Google Code Format
** Install Intellij plugin `google-code-format`
* There is nothing to configure.

== Architecture
Standard monolith model.

. Client calls API
. Controller intercepts and validates request
. Forward request to service layer
. Service sends queries to repositories
. Controller formats response

== UI
.Pages
* Dashboard: Display the meetings that the current user manages and that invite current user. (Pending response is a misnomer)
* Home: Main page
* MeetingEdit: Edit the meeting that the current user manages. Use `Generate Roster` button to generate solution.
* MeetingRank: Provide rank preferences to time slots in meeting that invites current user
* MeetingViewSolution: View the solution generated from rank preferences. Publishing overwrites meeting allocations with those from the solution.

.File structure
* `components`
* `core`: Utilities and React Context
* `pages`: Routed by React Router. Assembled from components.
* `test`: Jest unit tests

== Controller

== Service

== Repository

=== Schema design
Standard relational schema.

.Database schema
image::db.png[]

Note that `password` in the `users` table are `bcrypt` hashes. Associations are shown in the diagram and in code.

=== Choice of database
We chose PostgresSQL because it comes with Heroku. Definitely http://www.sarahmei.com/blog/2013/11/11/why-you-should-never-use-mongodb/[not MongoDB] though. Especially at our scale that's just premature optimization.

=== Choice of ORM
Spring Boot comes with Hibernate. Enough said.

== Tech stack
Check `package.json` for frontend libraries and `pom.xml` for backend libraries.

=== Frontend

==== React
We chose React since it helps with component reuse. And we both only know React for UI.

==== React Router
For routing.

==== Material UI
Provides most of the UI components.

==== Syncfusion
Provides scheduler and data grid component that send requests to backend whenever user manipulates them. Requires community license.

=== Backend

==== PostgresSQL
See above.

==== Spring Boot
An opinionated framework that configures Spring, the web application framework.

==== Spring Security
Handles authentication and access control checks.

==== OptaPlanner
AI Constraint solver. Generates solutions for meeting schedules given ranks.

==== Liquibase
Handles database migrations. Synchronize DB schemas among developers.

==== H2 Database
In memory database for integration tests.

==== Lombok
Generates boilerplate code like getters and setters.

==== Spring Data Rest
Generates RESTful API from repositories. Ensure API discoverability, uniformity and RESTfulness.

==== Spring Rest Docs
Generates the requests and responses from integration tests for API reference.

== Testing

=== Unit testing (Frontend)
TODO

=== Integration testing (Backend)
TODO

== API Reference

Almost all the API is generated by Spring Data Rest. All the requests and responses below are generated from integration tests by Spring Rest Docs. In addition, we expose a GUI at `/api/explorer` to discover API features.

.Supported HTTP Methods
* `POST /api/:resource` for creation
* `GET /api/:resource/:id` for read
* `PUT /api/:resource/:id` for update (replace with new data)
* `PATCH /api/:resource/:id` for update (modify specified fields)
* `DELETE /api/:resource/:id` for deletion
** `204 No content` if successful

=== User API
Users can be initially unregistered (created through invitations). The API is identical regardless of this.

==== Creation

Send `rawPassword` with at least 8 characters.

include::{snippets}/post-users-registered-success/http-request.adoc[]

If successful, return `201 Created` with `Location` set to `/api/users/:id`.

include::{snippets}/post-users-registered-success/http-response.adoc[]

===== Counterexamples

include::{snippets}/post-users-registered-password-error/http-request.adoc[]
include::{snippets}/post-users-registered-password-error/http-response.adoc[]

The `email` field is validated.

include::{snippets}/post-users-registered-email-error/http-request.adoc[]
include::{snippets}/post-users-registered-email-error/http-response.adoc[]

==== Read
include::{snippets}/get-users-success/http-request.adoc[]
include::{snippets}/get-users-success/http-response.adoc[]

In addition, `/api/users/me` provides current session user ID if that is not known.
include::{snippets}/get-users-me-success/http-request.adoc[]

Response is forwarded to `/api/users/:id`.

=== Roster Plan API
The current API stores meeting metadata in the entity `rosterPlan`. To be removed in later versions.

==== Creation

`title` cannot be blank.

include::{snippets}/givenValidRequest_whenCreate_thenCreateEmptyRosterPlan/http-request.adoc[]

If successful, return `201 Created` with `Location` set to `/api/rosterPlan/:id`.

include::{snippets}/givenValidRequest_whenCreate_thenCreateEmptyRosterPlan/http-response.adoc[]

===== Counterexamples

If `title` is blank,
include::{snippets}/givenInvalidRequest_whenCreate_thenBadRequest/http-request.adoc[]

Then
include::{snippets}/givenInvalidRequest_whenCreate_thenBadRequest/http-response.adoc[]

If user is not logged in,
include::{snippets}/givenAnonymousUser_whenCreate_thenRedirectToLogin/http-request.adoc[]

Then
include::{snippets}/givenAnonymousUser_whenCreate_thenRedirectToLogin/http-response.adoc[]

==== Read
include::{snippets}/get-rosterPlan-success/http-request.adoc[]
include::{snippets}/get-rosterPlan-success/http-response.adoc[]

==== Update
The current API disables ACL checks. In later versions user will need to be invited to view meeting information. Use the methods listed above to update attributes. Refer to API below to update sub-resources.

=== Time Slot API
Sub-resource of Roster Plan

==== Creation

.Validation
* `startDateTime`: ISOString format, earlier than `endDateTime`
* `endDateTime`: ISOString format, later than `startDateTime`
* `capacity`: positive integer
* `rosterPlan`: URI aka `/api/rosterPlan/:id`, the Roster Plan this time slot refers to

include::{snippets}/post-timeSlot-success/http-request.adoc[]

If successful, return `201 Created` with `Location` set to `/api/timeSlot/:id`.
include::{snippets}/post-timeSlot-success/http-response.adoc[]

===== Counterexamples

Date time issues
include::{snippets}/post-timeSlot-date-time-error/http-request.adoc[]
include::{snippets}/post-timeSlot-date-time-error/http-response.adoc[]

=== Roster Plan User Info API
Sub-resource of Roster Plan

==== Creation
.Validation
* `locked`: boolean.
** This feature is under refinement.
** If the user is locked, solver will lock in allocations of the user
* `email`: Email of the user to be invited
* `rosterPlan`: URI aka `/api/rosterPlan/:id`, the `rosterPlan` this time slot refers to

include::{snippets}/post-rosterPlanUserInfo-success/http-request.adoc[]

If successful, return `201 Created` with `Location` set to `/api/rosterPlanUserInfo/:id`.
include::{snippets}/post-rosterPlanUserInfo-success/http-response.adoc[]

=== Time Slot User Info API
Sub-resource of Time Slot

==== Creation
.Validation
* `rank`: positive integer.
* `timeSlot`: URI aka `/api/timeSlot/:id`, the `timeSlot` this association resource refers to

include::{snippets}/post-timeSlotUserInfo-success/http-request.adoc[]

If successful, return `201 Created` with `Location` set to `/api/timeSlotUserInfo/:id`.
include::{snippets}/post-timeSlotUserInfo-success/http-response.adoc[]